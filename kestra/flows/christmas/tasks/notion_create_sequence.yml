# Notion Create Email Sequence Task
# Create new email sequence tracking record in Notion Email Sequence database
#
# Inputs:
#   - email: Contact email address
#   - first_name: Contact first name
#   - business_name: Business name
#   - assessment_score: BusOS score (0-100)
#   - red_systems: Number of red (broken) systems
#   - orange_systems: Number of orange (struggling) systems
#   - yellow_systems: Number of yellow systems
#   - green_systems: Number of green systems
#   - segment: Classified segment (CRITICAL/URGENT/OPTIMIZE)
#   - sequence_type: Type of sequence (5day, noshow, postcall, onboarding)
#
# Outputs:
#   - response: Created Notion page with sequence_id
#
# Author: Kestra Migration Team
# Created: 2025-11-29
# Ported from: campaigns/christmas_campaign/tasks/notion_operations.py::create_email_sequence

id: notion_create_sequence
type: io.kestra.plugin.core.http.Request
uri: "https://api.notion.com/v1/pages"
method: POST
headers:
  Authorization: "Bearer {{ secret('SECRET_NOTION_TOKEN') }}"
  Notion-Version: "2022-06-28"
  Content-Type: "application/json"
contentType: application/json
body: |
  {
    "parent": {
      "database_id": "{{ secret('SECRET_NOTION_EMAIL_SEQUENCE_DB_ID') }}"
    },
    "properties": {
      "Email": {
        "email": "{{ inputs.email }}"
      },
      "First Name": {
        "rich_text": [
          {
            "text": {
              "content": "{{ inputs.first_name }}"
            }
          }
        ]
      },
      "Business Name": {
        "rich_text": [
          {
            "text": {
              "content": "{{ inputs.business_name }}"
            }
          }
        ]
      },
      "Assessment Score": {
        "number": {{ inputs.assessment_score | default(0) }}
      },
      "Red Systems": {
        "number": {{ inputs.red_systems | default(0) }}
      },
      "Orange Systems": {
        "number": {{ inputs.orange_systems | default(0) }}
      },
      "Yellow Systems": {
        "number": {{ inputs.yellow_systems | default(0) }}
      },
      "Green Systems": {
        "number": {{ inputs.green_systems | default(0) }}
      },
      "Segment": {
        "select": {
          "name": "{{ inputs.segment | default('OPTIMIZE') }}"
        }
      },
      "Campaign": {
        "select": {
          "name": "Christmas 2025"
        }
      },
      "Sequence Type": {
        "select": {
          "name": "{{ inputs.sequence_type | default('5day') }}"
        }
      },
      "Signup Date": {
        "date": {
          "start": "{{ now() }}"
        }
      },
      "Sequence Completed": {
        "checkbox": false
      },
      "Assessment Completed": {
        "checkbox": true
      }
    }
  }
